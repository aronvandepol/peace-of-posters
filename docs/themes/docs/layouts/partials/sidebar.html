{{- $page := . }}
{{- $menuID := "main" }}

{{- with index site.Menus $menuID }}
<div class="sidenav">
  {{- partial "inline/sidebar/walk.html" (dict "page" $page "menuEntries" .) }}
</div>
{{ end }}


<script>
/* Loop through all dropdown buttons to toggle between hiding and showing its dropdown content.
This allows the user to have multiple dropdowns without any conflict */
var dropdown = document.getElementsByClassName("dropdown-btn");
var i;

for (i = 0; i < dropdown.length; i++) {
    dropdown[i].addEventListener("click", function() {
      this.classList.toggle("expanded");
      this.attributes["expanded"] = true;
      var dropdownContent = this.nextElementSibling;
      dropdownContent.classList.toggle("hidden");
      /* if (dropdownContent.style.display === "block") {
        dropdownContent.style.display = "none";
      } else {
        dropdownContent.style.display = "block";
      }*/
    });
}

var j;
for (j = 0; j < dropdown.length; j++) {
  dd = dropdown[j]
  if (dd.classList.contains("expanded")) {
      var dropdownContent = dd.nextElementSibling;
      dropdownContent.style.display = "block";
      dropdownContent.classList.toggle("hidden");
  }
}
</script>

{{- define "partials/inline/sidebar/walk.html" }}
  {{- $page := .page }}
  {{- range .menuEntries }}
    {{- $attrs := dict "href" .URL}}
    {{- $attrs_button := dict "class" "dropdown-btn" }}
    {{- $attrs_image := dict "class" "arrow-menu" }}
    {{- if $page.IsMenuCurrent .Menu . }}
      {{- $attrs = merge $attrs (dict "class" "active" "aria-current" "page") }}
      {{- $attrs_button = merge $attrs_button (dict "class" "dropdown-btn ancestor expanded") }}
      {{- $attrs_image = merge $attrs_image (dict "class" "arrow-menu expanded")}}
    {{- else if $page.HasMenuCurrent .Menu .}}
      {{- $attrs = merge $attrs (dict "class" "ancestor" "aria-current" "true") }}
      {{- $attrs_button = merge $attrs_button (dict "class" "dropdown-btn expanded") }}
      {{- $attrs_image = merge $attrs_image (dict "class" "arrow-menu expanded")}}
    {{- end }}

    
    <div class="entry-formatter">
    <a
      {{- range $k, $v := $attrs }}
        {{- with $v }}
          {{- printf " %s=%q" $k $v | safeHTMLAttr }}
        {{- end }}
      {{- end -}}
    >{{ or (T .Identifier) .Name | safeHTML }}</a>
    {{- with .Children }}
        <button
        {{- range $k, $v := $attrs_button }}
          {{- with $v }}
              {{- printf " %s=%q" $k $v | safeHTMLAttr }}
          {{- end }}
          {{- end -}}><img
            {{- range $k, $v := $attrs_image }}
              {{- with $v }}
                {{- printf " %s=%q" $k $v | safeHTMLAttr }}
              {{- end }}
            {{- end -}}
          src="/arrow-menu.svg">
        </button>
        <div class="dropdown-container hidden">
          {{- partial "inline/sidebar/walk.html" (dict "page" $page "menuEntries" .) }}
        </div>
    {{- end }}
    </div>
  {{- end }}
{{- end }}
